// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Category {
  id              String    @id @default(uuid()) @map("_id")
  parentId        String?   @map("parent_id")
  name            String
  slug            String    @unique
  image           String?
  icon            String?
  description     String?   
  metaTitle       String?   @map("meta_title")
  metaDescription String?   @map("meta_description")
  metaKeywords    Json?     @map("meta_keywords")
  visibility      Int       @default(1) 
  isSpecial       Int       @default(0) @map("is_special") 
  status          Int       @default(1) 
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  // Relations
  parent          Category? @relation("CategoryParent", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  children        Category[] @relation("CategoryParent")
  productIds      String[]
  products        Product[] @relation(fields: [productIds], references: [id])

  @@map("categories")
}

model Brand {
  id          String    @id @default(uuid()) @map("_id")
  name        String
  slug        String    @unique
  image       String?
  isTop       Int       @default(0) @map("is_top") 
  status      Int       @default(1) 
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")

  // Relations
  products    Product[]

  @@map("brands")
}

model Product {
  id                String    @id @default(uuid()) @map("_id")
  name              String
  slug              String    @unique
  model             String?
  summary           String?   
  description       String?   
  extraDescriptions Json?     @map("extra_descriptions")
  specification     Json?
  brandId           String    @map("brand_id")
  sku               String?
  price             Float   
  discountType      Int       @default(1) @map("discount_type") 
  discount          Float     @default(0.00) 
  discountedPrice   Float     @default(0.00) @map("discounted_price") 
  quantity          Int       @default(0)
  sold              Int       @default(0)
  minimumBuyQty     Int       @default(1) @map("minimum_buy_qty")
  stockStatus       Int       @default(1) @map("stock_status") 
  track             Int       @default(1) 
  featured          Int       @default(0) 
  todaysDeal        Int       @default(0) @map("todays_deal") 
  status            Int       @default(1) 
  isFeatured        Int       @default(0) @map("is_featured") 
  isSlider          Int       @default(0) @map("is_slider") 
  mainImage         String?   @map("main_image")
  hoverImage        String?   @map("hover_image")
  metaTitle         String?   @map("meta_title")
  metaDescription   String?   @map("meta_description")
  metaKeywords      Json?     @map("meta_keywords")
  digitalItem       String?   @map("digital_item")
  digitalFile       String?   @map("digital_file")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")
  deletedAt         DateTime? @map("deleted_at")

  // Relations
  brand             Brand     @relation(fields: [brandId], references: [id])
  categoryIds       String[]
  categories        Category[] @relation(fields: [categoryIds], references: [id])
  images            ProductImage[]
  stocks            ProductStock[]
  reviews           ProductReview[]
  assignAttributes  AssignProductAttribute[]
  orderDetails      OrderDetail[]
  carts             Cart[]
  wishlists         Wishlist[]
  offerIds          String[]
  offers            Offer[]    @relation(fields: [offerIds], references: [id])
  couponIds         String[]
  coupons           Coupon[]   @relation(fields: [couponIds], references: [id])

  @@map("products")
}

model ProductImage {
  id        String   @id @default(uuid()) @map("_id")
  productId String   @map("product_id")
  image     String
  sortOrder Int      @default(0) @map("sort_order")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  product   Product  @relation(fields: [productId], references: [id])

  @@map("product_images")
}

model ProductStock {
  id        String   @id @default(uuid()) @map("_id")
  productId String   @map("product_id")
  sku       String?
  quantity  Int      @default(0)
  price     Float
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  product   Product  @relation(fields: [productId], references: [id])

  @@map("product_stocks")
}

model ProductReview {
  id        String   @id @default(uuid()) @map("_id")
  productId String   @map("product_id")
  userId    String   @map("user_id")
  rating    Int
  review    String?
  status    Int      @default(1)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  product   Product  @relation(fields: [productId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@map("product_reviews")
}

model AssignProductAttribute {
  id          String   @id @default(uuid()) @map("_id")
  productId   String   @map("product_id")
  attributeId String   @map("attribute_id")
  values      Json
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  product     Product    @relation(fields: [productId], references: [id])
  attribute   Attribute  @relation(fields: [attributeId], references: [id])

  @@map("assign_product_attributes")
}

model Attribute {
  id          String   @id @default(uuid()) @map("_id")
  name        String
  type        String
  isRequired  Boolean  @default(false) @map("is_required")
  status      Int      @default(1)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  products    AssignProductAttribute[]

  @@map("attributes")
}

model User {
  id            String    @id @default(uuid()) @map("_id")
  name          String
  email         String    @unique
  password      String
  phone         String?
  address       Json?
  role          String    @default("user")
  status        Int       @default(1)
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  deletedAt     DateTime? @map("deleted_at")

  // Relations
  reviews       ProductReview[]
  orders        Order[]
  carts         Cart[]
  wishlists     Wishlist[]

  @@map("users")
}

model Order {
  id              String    @id @default(uuid()) @map("_id")
  userId          String    @map("user_id")
  orderNumber     String    @unique @map("order_number")
  totalAmount     Float     @map("total_amount")
  status          String    @default("pending")
  paymentStatus   String    @default("pending") @map("payment_status")
  paymentMethod   String    @map("payment_method")
  shippingAddress Json      @map("shipping_address")
  billingAddress  Json      @map("billing_address")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  deletedAt       DateTime? @map("deleted_at")

  // Relations
  user            User     @relation(fields: [userId], references: [id])
  orderDetails    OrderDetail[]

  @@map("orders")
}

model OrderDetail {
  id        String   @id @default(uuid()) @map("_id")
  orderId   String   @map("order_id")
  productId String   @map("product_id")
  quantity  Int
  price     Float
  total     Float
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  order     Order    @relation(fields: [orderId], references: [id])
  product   Product  @relation(fields: [productId], references: [id])

  @@map("order_details")
}

model Cart {
  id        String   @id @default(uuid()) @map("_id")
  userId    String   @map("user_id")
  productId String   @map("product_id")
  quantity  Int      @default(1)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  user      User     @relation(fields: [userId], references: [id])
  product   Product  @relation(fields: [productId], references: [id])

  @@map("carts")
}

model Wishlist {
  id        String   @id @default(uuid()) @map("_id")
  userId    String   @map("user_id")
  productId String   @map("product_id")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  user      User     @relation(fields: [userId], references: [id])
  product   Product  @relation(fields: [productId], references: [id])

  @@map("wishlists")
}

model Offer {
  id          String    @id @default(uuid()) @map("_id")
  title       String
  description String?
  startDate   DateTime  @map("start_date")
  endDate     DateTime  @map("end_date")
  discount    Float
  status      Int       @default(1)
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")

  // Relations
  productIds  String[]
  products    Product[] @relation(fields: [productIds], references: [id])

  @@map("offers")
}

model Coupon {
  id          String    @id @default(uuid()) @map("_id")
  code        String    @unique
  type        String
  value       Float
  minAmount   Float     @map("min_amount")
  maxAmount   Float?    @map("max_amount")
  startDate   DateTime  @map("start_date")
  endDate     DateTime  @map("end_date")
  usageLimit  Int       @default(0) @map("usage_limit")
  usageCount  Int       @default(0) @map("usage_count")
  status      Int       @default(1)
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")

  // Relations
  productIds  String[]
  products    Product[] @relation(fields: [productIds], references: [id])

  @@map("coupons")
}